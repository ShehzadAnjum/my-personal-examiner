# Economics 9708 PDF Question Extraction Patterns
# Version: 1.0
# Created: 2025-12-18
# Applies to: Cambridge International Economics 9708 (2018-2023 syllabus)

version: "1.0"
subject_code: "9708"
subject_name: "Economics"

# ==============================================================================
# Question Delimiter Patterns
# ==============================================================================

question_delimiter:
  # Primary pattern: Single-digit question numbers (1-9) followed by capital letter or subpart
  # Economics papers typically have 1-4 questions per paper
  # Matches "1 Economic..." and "2 (a) With..." but NOT "2 Section A" or "12 Inflation"
  # Negative lookahead (?!Section) excludes section headers
  # Capturing group preserves numbers when using re.split()
  primary: "(^[1-9]\\s+(?!Section)(?=[A-Z(]))"

  # Alternative patterns (for robustness)
  alternatives:
    - "Question\\s+\\d+"  # Some papers use "Question 1", "Question 2"
    - "Q\\.?\\s*\\d+"  # Some mark schemes use "Q1", "Q.1"
    - "\\d+\\."  # Numbered list format "1.", "2."

  # Flags for regex matching
  flags:
    - IGNORECASE
    - MULTILINE

# ==============================================================================
# Marks Notation Patterns
# ==============================================================================

marks_pattern:
  # Primary pattern: "[8]", "[12]", "[25]" (Economics uses compact notation)
  # Also matches "[25 marks]" for backwards compatibility
  primary: "\\[\\d+(?:\\s+marks?)?\\]"

  # Alternative patterns
  alternatives:
    - "\\(\\d+(?:\\s+marks?)?\\)"  # Parentheses format
    - "\\d+\\s+marks?"  # Plain "25 marks" without brackets

  # Extraction group (for capturing just the number)
  # Matches both "[8]" and "[8 marks]"
  number_extraction: "\\[(\\d+)(?:\\s+marks?)?\\]"

# ==============================================================================
# Subpart Patterns
# ==============================================================================

has_subparts: true

subpart_patterns:
  # Pattern 1: (a), (b), (c) - most common in Economics
  lowercase_parentheses:
    pattern: "\\([a-z]\\)"
    examples:
      - "(a)"
      - "(b)"
      - "(c)"

  # Pattern 2: (i), (ii), (iii) - used for nested subparts
  roman_numerals:
    pattern: "\\([ivx]+\\)"
    examples:
      - "(i)"
      - "(ii)"
      - "(iii)"
      - "(iv)"

  # Pattern 3: 1.1, 1.2, 1.3 - rare but possible
  decimal_notation:
    pattern: "\\d+\\.\\d+"
    examples:
      - "1.1"
      - "1.2"

# Subpart aggregation rules
subpart_aggregation:
  # Sum marks from all subparts to get total question marks
  sum_marks: true

  # Concatenate subpart text with delimiter
  text_delimiter: "\n\n"

  # Preserve subpart labels in concatenated text
  preserve_labels: true

# ==============================================================================
# Header/Footer Filtering
# ==============================================================================

headers_footers_to_remove:
  - pattern: "Cambridge International.*?AS\\s+and\\s+A\\s+Level.*?Economics\\s+9708"
    description: "Standard Cambridge header"

  - pattern: "©\\s+UCLES\\s+\\d{4}"
    description: "Copyright notice"

  - pattern: "\\[Turn\\s+over\\]?"
    description: "Page turn instruction"

  - pattern: "\\d{4}/\\d{2}/[A-Z]/\\d{2}"
    description: "Paper code footer (e.g., 9708/32/M/J/23)"

  - pattern: "Page\\s+\\d+\\s+of\\s+\\d+"
    description: "Page numbering"

  - pattern: "^\\d+$"  # Line containing only a page number
    description: "Standalone page number"

# ==============================================================================
# Diagram/Table Placeholder Patterns
# ==============================================================================

diagram_detection:
  # Patterns indicating a diagram is present
  indicators:
    - "Figure\\s+\\d+"
    - "Diagram\\s+\\d+"
    - "Graph\\s+showing"
    - "curve"  # Supply curve, demand curve, etc.
    - "axis"
    - "vertical axis"
    - "horizontal axis"

  # Placeholder format for diagram references
  placeholder_format: "[DIAGRAM: {description}]"

  # Whether to attempt diagram caption extraction
  extract_captions: true

  # Caption patterns
  caption_patterns:
    - "Figure\\s+\\d+:\\s*(.+)"
    - "Diagram\\s+showing\\s+(.+)"

# ==============================================================================
# Table Detection
# ==============================================================================

table_detection:
  # Patterns indicating a table is present
  indicators:
    - "Table\\s+\\d+"
    - "\\|.+\\|"  # Pipe-delimited tables
    - "Price\\s+Quantity"  # Common Economics table headers
    - "Year.+GDP"

  # Placeholder format
  placeholder_format: "[TABLE: {description}]"

  # Whether to attempt table extraction (pdfplumber handles this)
  extract_tables: true

# ==============================================================================
# Multi-page Question Handling
# ==============================================================================

multi_page_questions:
  # Allow questions to span multiple pages
  enabled: true

  # How to determine question boundaries
  boundary_detection: "next_question_or_end"

  # Maximum pages a single question can span (safety limit)
  max_pages_per_question: 3

  # Concatenation behavior
  concatenate_pages: true
  page_delimiter: "\n\n"

# ==============================================================================
# Paper-Specific Patterns
# ==============================================================================

paper_2_patterns:
  # Data Response papers often have context passages
  context_indicators:
    - "Extract\\s+\\d+"
    - "Source:"
    - "Data\\s+showing"

  # Typical question structure
  questions_per_paper: 3
  typical_marks_per_question: "8-20"

paper_3_patterns:
  # Essay papers
  typical_questions_available: "6-8"
  student_must_answer: 3
  typical_marks_per_question: 25

  # Essay question keywords
  essay_indicators:
    - "Discuss"
    - "Evaluate"
    - "To what extent"
    - "Assess"
    - "Explain why"
    - "Consider"

# ==============================================================================
# Mark Scheme-Specific Patterns
# ==============================================================================

mark_scheme_patterns:
  # Detect if PDF is a mark scheme (not question paper)
  mark_scheme_indicators:
    - "Mark\\s+Scheme"
    - "MARK\\s+SCHEME"
    - "Marks?:\\s*\\d+"
    - "Level\\s+\\d+"
    - "Award\\s+\\d+\\s+marks?"

  # Extraction for mark schemes (different from questions)
  level_descriptor_pattern: "Level\\s+(\\d+):\\s+([\\d-]+)\\s+marks?\\s+[–-]\\s+(.+)"

  # Model answer indicators
  model_answer_patterns:
    - "Exemplar\\s+answer"
    - "Model\\s+answer"
    - "Accept:?"
    - "Credit:?"

# ==============================================================================
# Error Handling & Edge Cases
# ==============================================================================

error_handling:
  # What to do if no questions found
  no_questions_found: "raise_error"

  # What to do if marks cannot be extracted for a question
  missing_marks:
    behavior: "use_default"
    default_value: null  # Will require manual review

  # What to do with ambiguous question numbers
  duplicate_question_numbers:
    behavior: "use_sequential_numbering"
    log_warning: true

# ==============================================================================
# Validation Rules
# ==============================================================================

validation:
  # Expected marks range per question
  marks_range:
    min: 1
    max: 30

  # Expected question number range
  question_number_range:
    min: 1
    max: 50

  # Minimum question text length (characters)
  min_question_length: 20

  # Maximum question text length (characters, safety check)
  max_question_length: 5000

# ==============================================================================
# Notes
# ==============================================================================

notes: |
  This configuration is optimized for Cambridge International Economics 9708
  past papers from 2018-2023 syllabus period. Patterns may need adjustment for:

  - Pre-2018 papers (different formatting)
  - Other Economics syllabi (IGCSE, O-Level)
  - Other subjects (will have different question structures)

  When adapting for other subjects:
  - Update question_delimiter (e.g., Math uses "Q\d+" not "Question \d+")
  - Update marks_pattern (e.g., some subjects use "marks:" instead of "[marks]")
  - Update subpart_patterns if different convention used
  - Update header/footer patterns for different exam boards

  Tested with 10+ Economics 9708 PDFs achieving >95% extraction accuracy.
